<script>
  $(document).on("click",".product-form__cart-submit",function(e){
    e.preventDefault();
    var dataURL = $(".new_url").val();
    var blobBin = atob(dataURL.split(',')[1]);
    var array = [];
    for(var i = 0; i < blobBin.length; i++) {
        array.push(blobBin.charCodeAt(i));
    }
    var file=new Blob([new Uint8Array(array)], {type: 'image/png'});
    const prodID = $('select[name="id"]').val()
    const qty = $('input[name="quantity"]').val()
    var formdata = new FormData();
    
    formdata.append('id', prodID)
    formdata.append('quantity', qty);
    formdata.append("properties[Custom Image]", file,"final_image.png");
    
          
      const _btn = jQuery('button[name="add"]').prop('disabled', true)
      _btn.css('opacity', 0.5)
      _btn.append('<i class="fa fa-refresh fa-spin"></i>')
      
$.ajax({
            url:'/cart/add.js',
            type:'POST',
            data:formdata,
            contentType:false,
    processData:false,
    cache:false,
    dataType:"json", // Change this according to your response from the server.
            success:function(res){
                console.log(res);   
              window.location.href='/cart';
},
            error:function(kk){
                      _btn.removeProp('disabled')
        _btn.css('opacity', 1)
        _btn.find('i.fa').remove()
                console.log(kk);            
}
});
  });
</script>
